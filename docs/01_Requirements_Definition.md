# MochiRAG 要件定義書

## 1. 概要

本ドキュメントは、Retrieval-Augmented Generation (RAG) システム「MochiRAG」の要件を定義する。
MochiRAGは、ユーザーが自身のドキュメントをアップロードし、その内容に基づいてAIと対話するための、マルチテナント対応のWebアプリケーションである。各ユーザーのデータは安全に分離され、信頼性の高い回答生成を目指す。

## 2. 用語定義

| 用語 | 説明 |
| --- | --- |
| RAG | Retrieval-Augmented Generation（検索拡張生成）。大規模言語モデル（LLM）が外部の知識ベースを検索し、その情報を基に回答を生成する技術。 |
### 3.1. ユーザー管理機能

| ID | 要件 |
| --- | --- |
| FR-U-01 | 新規ユーザーは、メールアドレスとパスワードを使用してシステムに登録できる。 |
| FR-U-02 | 登録済みユーザーは、メールアドレスとパスワードでログインできる。 |
| FR-U-03 | ログインに成功したユーザーには、APIアクセスのための認証トークン（JWT）が発行される。 |
| FR-U-04 | ユーザーは、自身のユーザー情報を確認できる。 |

### 3.2. データセット管理機能

| ID | 要件 |
| --- | --- |
| FR-DS-01 | ユーザーは、自身のデータセットを新規に作成できる。 |
| FR-DS-02 | ユーザーは、自身が作成したデータセットの一覧を表示できる。 |
| FR-DS-03 | ユーザーは、自身のデータセットを削除できる。データセットを削除すると、それに含まれるドキュメントもすべて削除される。 |

### 3.3. ドキュメント管理機能

| ID | 要件 |
| --- | --- |
| FR-D-01 | ユーザーは、指定したデータセットにドキュメント（ファイル）をアップロードできる。 |
| FR-D-02 | 対応するファイル形式は、テキスト（.txt）、マークダウン（.md）、PDF（.pdf）とする。 |
| FR-D-03 | アップロードされたドキュメントは、アップロードしたユーザーと指定されたデータセットに紐づけて管理される。 |
| FR-D-04 | ユーザーは、データセット内のドキュメント一覧を表示できる。 |
| FR-D-05 | ユーザーは、データセットから特定のドキュメントを削除できる。 |

### 3.4. RAGチャット機能

| ID | 要件 |
| --- | --- |
| FR-RAG-01 | ユーザーは、チャットインターフェースを通じて自然言語で質問を入力できる。 |
| FR-RAG-02 | システムは、ユーザーの質問に対し、アップロードされたドキュメントの内容を基に回答を生成する。 |
| FR-RAG-03 | ユーザーは、質問時に検索対象とするデータセットを一つまたは複数指定できる。 |
| FR-RAG-04 | ユーザーは、質問時に使用するRAG戦略を選択できる。 |
| FR-RAG-05 | 生成された回答には、根拠となったドキュメントの出典情報（ファイル名、ページ番号など）を付与する。 |
| FR-RAG-06 | 関連する情報がドキュメント内に見つからない場合、その旨をユーザーに伝える。 |

### 3.5. UI/UX要件

| ID | 関連FR | UI要件 | 優先度 | 実装状況 |
| --- | --- | --- | --- | --- |
| FR-UI-01 | FR-U-01 | 新規ユーザーが登録するための、独立した「サインアップ」ページまたはフォームが必要です。 | 高 | **実装済み** (`frontend/app.py`にてタブ形式で提供) |
| FR-UI-02 | FR-DS-02, FR-D-04 | ユーザーが所有するデータセットと、その中のドキュメントを一覧表示するための、専用の管理画面が必要です。 | 中 | **実装済み** (`frontend/ui_sidebar.py`にてExpander形式で提供) |
| FR-UI-03 | FR-DS-03, FR-D-05 | データセットとドキュメントを削除するための、明確なUIコントロール（例：削除ボタン）が必要です。誤操作を防ぐための確認ダイアログも実装する必要があります。 | 中 | **実装済み** (`frontend/ui_sidebar.py`にて実装。StreamlitのUI制約上、確認はボタン押下を以て代用) |
| FR-UI-04 | FR-RAG-03 | チャット画面において、ユーザーがクエリ対象として複数のデータセットを選択できるUI（例：マルチセレクトボックス）が必要です。 | 高 | **実装済み** (`frontend/ui_chat.py`にて`st.multiselect`で実装) |
| FR-UI-05 | FR-RAG-04 | チャット画面において、ユーザーが使用するRAG戦略（`basic`, `multi_query`など）を選択できるUI（例：ドロップダウンメニュー）が必要です。 | 高 | **実装済み** (`frontend/ui_chat.py`にて`st.selectbox`で実装) |
| FR-UI-06 | FR-U-04 | ユーザーが自身の登録情報を確認できる「ユーザー情報」または「アカウント」ページが必要です。 | 低 | 未実装 |

## 4. 非機能要件

### 4.1. マルチテナンシー

| ID | 要件 |
| --- | --- |
| NFR-MT-01 | あるユーザーのデータ（データセット、ドキュメント、ベクトルデータ等）は、他のユーザーから完全に分離され、アクセスできないこと。 |

### 4.2. セキュリティ

| ID | 要件 |
| --- | --- |
| NFR-SEC-01 | ユーザーのパスワードは、ハッシュ化して安全に保管すること。平文で保存してはならない。 |
| NFR-SEC-02 | データアクセスを伴う全てのAPIエンドポイントは、有効な認証トークンなしではアクセスできないこと。 |

### 4.3. パフォーマンス

| ID | 要件 |
| --- | --- |
| NFR-PERF-01 | チャットの応答時間は、一般的な利用において許容可能な範囲であること（具体的な目標値は別途定義）。 |
| NFR-PERF-02 | ドキュメントのアップロードとインデックス作成処理は、バックグラウンドで実行され、ユーザーの操作を妨げないこと。（将来的な改善項目） |

### 4.4. 拡張性と保守性

| ID | 要件 |
| --- | --- |
| NFR-EXT-01 | 新しいRAG戦略を容易に追加できるアーキテクチャであること。 |
| NFR-EXT-02 | 大規模言語モデル（LLM）は、Ollamaだけでなく、OpenAI、Azure OpenAI、Google Geminiなど、複数のプロバイダーをサポートし、設定変更によって容易に切り替えられること。ベクトルストアなどの他の主要コンポーネントも同様に切り替え可能であること。 |
| NFR-EXT-03 | 設定値（モデル名、チャンクサイズ等）は、コード内へのハードコーディングではなく、外部の設定ファイルで管理すること。 |

### 4.5. 運用性

| ID | 要件 |
| --- | --- |
| NFR-OPS-01 | システム全体（バックエンド、フロントエンド）がDockerコンテナとして実行可能であること。 |
| NFR-OPS-02 | 開発環境のセットアップ手順がドキュメント化されており、容易に構築できること。 |
