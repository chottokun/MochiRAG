# MochiRAG プロジェクト テスト実行ガイド

このドキュメントは、MochiRAGプロジェクトに実装されている自動テストを実行し、その結果についてフィードバックをいただくためのガイドです。

## 1. テスト環境のセットアップ

テストを実行する前に、以下の手順で環境をセットアップしてください。

1.  **リポジトリの準備**:
    *   まだクローンしていない場合は、リポジトリをクローンします。
    *   すでにクローン済みの場合は、`initial-development-and-review-prep` ブランチの最新の変更を取得（pull）してください。
        ```bash
        # git clone <リポジトリURL> # まだの場合
        # cd <リポジトリ名>
        git fetch origin
        git checkout initial-development-and-review-prep
        git pull origin initial-development-and-review-prep
        ```

2.  **Python仮想環境の作成と有効化**:
    *   プロジェクトのルートディレクトリで、Pythonの仮想環境を作成し、有効化します。（Python 3.10以上を推奨）
        ```bash
        python -m venv venv
        source venv/bin/activate  # Linux/macOS の場合
        # venv\Scripts\activate    # Windows の場合
        ```

3.  **依存関係のインストール**:
    *   必要なPythonパッケージをインストールします。
        ```bash
        pip install -r requirements.txt
        ```
    *   フロントエンドのテストを後で行う場合は、フロントエンド用の依存関係もインストールが必要になりますが、現在の自動テストは主にバックエンドとコアロジックを対象としています。
        ```bash
        # pip install -r frontend/requirements.txt # フロントエンド関連のテスト時
        ```

## 2. テストの実行

テストは `pytest` フレームワークを使用しています。プロジェクトのルートディレクトリで以下のコマンドを実行してください。

1.  **基本的なテスト実行**:
    *   すべてのテストを実行します。
        ```bash
        pytest
        ```

2.  **詳細な出力でのテスト実行**:
    *   各テストの結果をより詳細に表示します。エラー発生時の原因特定に役立ちます。
        ```bash
        pytest -vv
        ```

3.  **特定のテストファイルの実行**:
    *   特定のテストファイルのみを実行したい場合は、ファイルパスを指定します。
        ```bash
        pytest tests/backend/test_auth.py
        ```

## 3. 期待される結果 (現状)

-   現在実装されているテスト（主に `tests/backend/test_auth.py` 内の認証関連テスト）は、**すべてパスする（成功する）こと**を期待しています。
-   これらのテストは、ユーザーデータベースの代わりに一時的なテスト用データベースを使用し、各テストケースの独立性を保つように設計されています。

## 4. フィードバックのお願い

テスト結果や内容に関して、以下の点についてフィードバックをいただけると大変助かります。

### テストが失敗する場合
-   **失敗したテストケース名**: どのテスト関数（例: `test_login_for_access_token`）が失敗したか。
-   **完全なエラーメッセージとトレースバック**: `pytest` が出力したエラーメッセージ全体と、エラー発生箇所までのスタックトレース。

### テストが成功する場合
-   すべてのテストが問題なくパスした旨のご連絡。

### テスト改善に関するご提案（任意）
-   **不足しているテストケース**: 「〇〇のシナリオについてもテストを追加すべきではないか？」といったご提案。
-   **テストの前提条件やアサーションに関するコメント**: テストコード内の仮定や検証内容についての妥当性など。
-   **テストコードの可読性や効率性に関するフィードバック**: より良いテストコードにするためのアイデア。

### 【任意】Ollama関連のフィードバック（将来のため、Ollama環境をお持ちの場合）
-   この `pytest` スイートには含まれていませんが、もしローカルにOllama (`llama3` モデルを含む) の実行環境をお持ちでしたら、`core/rag_chain.py` の自己実行テストをお試しいただくことも可能です。
    ```bash
    python -m core.rag_chain
    ```
    このスクリプトは、Ollamaとの連携を含むRAGチェーンの動作テストを試みます。その際の出力（特にエラーなく応答が生成されるか、またはOllama接続エラーが適切に表示されるかなど）に関するフィードバックは、RAG機能の今後の開発にとって非常に有益です。
    *   **注意**: 現在の自動テスト環境ではOllamaが実行されていないため、`core.rag_chain` のテストはLLM連携部分で接続エラーとなり、フォールバックメッセージ（「I'm sorry, but I encountered an error...」）が表示されることを想定しています。

ご協力のほど、どうぞよろしくお願いいたします。
